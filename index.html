<!DOCTYPE HTML>
<!--
	Big Picture by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>QuickLoan - Crédito al instante</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript>&lt;link rel="stylesheet" href="assets/css/noscript.css" /&gt;</noscript>


	</head>
	<body>
		<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2"></script>

		<!-- Header -->
			<header id="header">
				<h1>QuickLoan</h1>
				<nav>
					<ul>
						<li><a href="#intro">Inicio</a></li>
						<li><a href="#one">Obtener mi crédito</a></li>
						<li><a href="#nos">Nosotros</a></li>
						<li><a href="login/">Iniciar sesión</a></li>
					</ul>
				</nav>
			</header>

		<!-- Intro -->
			<section id="intro" class="main style1 dark fullscreen">
				<div class="content">
					<header>
						<h2>Obtén tu préstamo al instante</h2>
					</header>
					<p>Impulsa el crecimiento de tu empresa</p>
					<footer>
						<a href="#one" class="button style2 ">Pide tu préstamo</a>
					</footer>
				</div>
			</section>
			<section id="nos" class="main style1 fullscreen">
				<div class="content">
					<header>
						<h2 style="color:black">Rápido y simple</h2>
						<h2 style="color:black">Tasas justas</h2>
						<h2 style="color:black">Sin aval ni garantías</h2>
					</header>
					<footer>
						<a href="#one" class="button style2 " style="color:black">Pide tu préstamo</a>
					</footer>
				</div>
			</section>

		<!-- One -->
			<section id="one" class="main style2 center dark fullscreen">
				<div class="content box style2" id="propuesta" hidden>
					<form id="confForm">
					<header>
						<h4 id="mensajePropuesta"></h4>
						<div id="infoAceptado">
							<p>Monto: <input placeholder="Monto" onchange="recalcular()" type="number" step=".1" id="cantidadPropuesta" name="cantidad" ></p>
							<p>Tu tasa es de <strong id ="tasaPropuesta"></strong>% anual</p>
							<div id="opcionesPago"></div>
							<h1>Tu mensualidad es de: <span id="mensualidad"></span></h1>
							<button type="submit">Aceptar crédito</button>

						</div>
					</header>
					</form>
				</div>
				<div class="content box style2" id="datos">
					<style>
						/* Style the input fields */
						input{
						  padding: 10px;
						  width: 100%;
						  font-size: 17px;
						  font-family: Raleway;
						  border: 1px solid #aaaaaa;
						}

						/* Mark input boxes that gets an error on validation: */
						input.invalid {
						  background-color: #ffdddd;
						}

						/* Hide all steps by default: */
						.tab {
						  display: none;
						}

						/* Make circles that indicate the steps of the form: */
						.step {
						  height: 15px;
						  width: 15px;
						  margin: 0 2px;
						  background-color: #bbbbbb;
						  border: none;
						  border-radius: 50%;
						  display: inline-block;
						  opacity: 0.5;
						}

						/* Mark the active step: */
						.step.active {
						  opacity: 1;
						}

						/* Mark the steps that are finished and valid: */
						.step.finish {
						  background-color: #4CAF50;
						}
					</style>
					<form id="myForm">

					<h1>Solicitud de crédito:</h1>


					<!-- One "tab" for each step in the form: -->
					<div class="tab">Nombre:
					  <p><input placeholder="Nombre" type="text" oninput="this.className = ''" value="Pablo Ramirez" name="nombre"><br/>
						o <img src="https://content.linkedin.com/content/dam/developer/global/en_US/site/img/signin-button.png" alt="Sign in with LinkedIn" data-linktype="external" class="x-hidden-focus">
					</p>
					<div class="fb-login-button" data-width="" data-size="medium" data-button-type="login_with" data-auto-logout-link="false" data-use-continue-as="false"></div>

					</div>

					<div class="tab">Correo:
					  <p><input placeholder="Correo" type="text" oninput="this.className = ''" value="jpramang@gmail.com" name="correo"></p>

					</div>
					<div class="tab">Teléfono:
					  <p><input placeholder="Teléfono" type="text" oninput="this.className = ''" value="55555555" name="telefono"></p>
					</div>

					<div class="tab">Fecha de nacimiento:
					  <p><input placeholder="dd/mm/aaa" type="date" oninput="this.className = ''" name="dia" value="01/08/2019" ></p>

					</div>
					<div class="tab">Monto a solicitar:
					  <p><input type="number" placeholder="E.j. 100000" type="text" oninput="this.className = ''" value="700000" name="cantidad"></p>
					</div>
					<div class="tab">Plazo en meses:
					  <p><input type="number" placeholder="E.j. 1" type="text" oninput="this.className = ''" value="36" name="plazo"></p>
					</div>
					<div class="tab">Ingreso mensual:
					  <p><input type="number" placeholder="E.j. 20000" type="text" oninput="this.className = ''" value="67000" name="ingreso"></p>
					</div>
					<div class="tab">Puntos SAT:
					  <p><input type="number" placeholder="E.j. 80" type="text" oninput="this.className = ''" value="98" name="SAT"></p>
					</div>
					<div class="tab">Puntos Buró de crédito:
					  <p><input type="number" placeholder="E.j. 80"  type="text" oninput="this.className = ''" value="80" name="BURO"></p>
					</div>

					<div style="overflow:auto;">
					  <div style="float:right;">
					    <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
					    <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
					  </div>
					</div>

					<!-- Circles which indicates the steps of the form: -->
					<div style="text-align:center;margin-top:40px;">
					  <span class="step"></span>
					  <span class="step"></span>
					  <span class="step"></span>
					  <span class="step"></span>
						<span class="step"></span>
						<span class="step"></span>
						<span class="step"></span>
						<span class="step"></span>
						<span class="step"></span>
					</div>

					</form>
	    </div>
	</div>
	<!-- /.MultiStep Form -->
							 </form>
				</div>
			</section>

		<!-- Footer -->
			<footer id="footer">

			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.poptrox.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
			<script>
			var cantidadMax, tasa, mensualidad, cantidad, correo;
			function getFormData($form){
			    var unindexed_array = $form.serializeArray();
			    var indexed_array = {};

			    $.map(unindexed_array, function(n, i){
			        indexed_array[n['name']] = n['value'];
			    });

			    return indexed_array;
			}
			$('#confForm').submit(function (e) {
            e.preventDefault()
             var data = getFormData($('#confForm'));
						 data["tipo"]="aceptacion";
						 data["cantidad"] = cantidad;
						 var plazo = parseInt($("#plazoSelect").val());
						 data["total"] = cantidad*(1+tasa/12/100*plazo);
						 data["correo"] = correo;
						 data["plazo"] = plazo;
						 var postdata = JSON.stringify(data);


                  $.ajax({
                        type: 'POST',
                        url: 'https://7equ60ji63.execute-api.us-east-2.amazonaws.com/TEST',
                        data: postdata,
                        dataType: 'json'
                  }).done(function (result) {
										$('#mensajePropuesta').html(result["mensaje"]);
										$('#infoAceptado').attr("hidden",true);
										console.log(result);
                  }).fail(function () {

                  })
                  return false

      })

		 var currentTab = 0; // Current tab is set to be the first tab (0)
showTab(currentTab); // Display the current tab

function showTab(n) {
  // This function will display the specified tab of the form ...
  var x = document.getElementsByClassName("tab");
  x[n].style.display = "block";
  // ... and fix the Previous/Next buttons:
  if (n == 0) {
    document.getElementById("prevBtn").style.display = "none";
  } else {
    document.getElementById("prevBtn").style.display = "inline";
  }
  if (n == (x.length - 1)) {
    document.getElementById("nextBtn").innerHTML = "Submit";
  } else {
    document.getElementById("nextBtn").innerHTML = "Next";
  }
  // ... and run a function that displays the correct step indicator:
  fixStepIndicator(n)
}

function nextPrev(n) {
  // This function will figure out which tab to display
  var x = document.getElementsByClassName("tab");
  // Exit the function if any field in the current tab is invalid:
  if (n == 1 && !validateForm()) return false;
  // Hide the current tab:
  x[currentTab].style.display = "none";
  // Increase or decrease the current tab by 1:
  currentTab = currentTab + n;
  // if you have reached the end of the form... :
  if (currentTab >= x.length) {
				var data = getFormData($('#myForm'));
				data["tipo"]="solicitud";
				data["SAT"] = parseInt(data["SAT"]);
				data["BURO"] = parseInt(data["BURO"]);
				data["ingreso"] = parseInt(data["ingreso"]);
				data["plazo"] = parseInt(data["plazo"]);
				data["cantidad"] = parseInt(data["cantidad"]);
				 var postdata = JSON.stringify(data);
				 var error = false
				 if (!error) {
							 $.ajax({
										 type: 'POST',
										 url: 'https://7equ60ji63.execute-api.us-east-2.amazonaws.com/TEST/',
										 data: postdata,
										 dataType: 'json'
							 }).done(function (result) {
								 	console.log(result);
								 	$('#datos').attr("hidden",true);
									$('#propuesta').attr("hidden",false);
									$('#mensajePropuesta').html(result["mensaje"]);
									correo = result["correo"];
									if(result["clasificacion"] != "D")
									{
										$('#cantidadPropuesta').val(((parseFloat(result["cantidad"])<parseFloat(result["cantidadNueva"]))?result["cantidad"]:result["cantidadNueva"]));
										cantidadMax = parseFloat(result["cantidadNueva"]);
										cantidad = parseFloat(((parseFloat(result["cantidad"])<parseFloat(result["cantidadNueva"]))?result["cantidad"]:result["cantidadNueva"]));
										tasa = parseInt(((result["calificacion"] == 'A')? "25": ((result["calificacion"] == 'B')?"29":"35" )));
										$('#tasaPropuesta').html(tasa);
										 var radio = "<select name='plazo' onchange='recalcular()' id='plazoSelect'>";
										 var clase = "", plazo = false;
										for(var i = 0; i < result["opciones"].length; i++)
										{
											if(result["plazo"] == result["opciones"][i]["plazos"])
											{
												plazo = true;
												clase="selected";
												mensualidad=result["opciones"][i]["mensualidad"];
											}else if(!plazo && i+1 == result["opciones"].length)
											{
												clase="selected";
												mensualidad=result["opciones"][i]["mensualidad"];

											}
											radio+="<option value='"+result["opciones"][i]["plazo"]+"' "+clase+">"+result["opciones"][i]["nombre"]+"</option>";
											clase="";
										}
										radio+="</select>";
										$('#opcionesPago').html(radio);
										$('#mensualidad').html("$"+mensualidad.replace(/\B(?=(\d{3})+(?!\d))/g, ","));


									}else
									{
										$('#infoAceptado').attr("hidden",true);
									}

										//$('#datos').html("<p>"+JSON.stringify(result)+"</p>");


							 }).fail(function(jqXHR, textStatus, errorThrown) {
									console.log(errorThrown);
							 })
							 return false
				 }

    return false;
  }
  // Otherwise, display the correct tab:
  showTab(currentTab);
}
function recalcular(){
	if(parseFloat($('#cantidadPropuesta').val()) > cantidadMax)
	{
		$('#mensualidad').html("NO SE PUEDE ELEGIR MÁS QUE LA CANTIDAD MÁXIMA");
	}else if(parseFloat($('#cantidadPropuesta').val()) < 100000)
	{
		$('#mensualidad').html("NO SE PUEDE ELEGIR UNA CANTIDAD MENOR A $100,000");
	} else
	{
		cantidad = $('#cantidadPropuesta').val();
		cantidad = parseFloat(cantidad);
		var plazo = parseInt($("#plazoSelect").val());
		$('#mensualidad').html("$ "+(cantidad*(1+tasa/12/100*plazo)/plazo).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ","));
	}
}
function validateForm() {
  // This function deals with validation of the form fields
  var x, y, i, valid = true;
  x = document.getElementsByClassName("tab");
  y = x[currentTab].getElementsByTagName("input");
  // A loop that checks every input field in the current tab:
  for (i = 0; i < y.length; i++) {
    // If a field is empty...
    if (y[i].value == "") {
      // add an "invalid" class to the field:
      y[i].className += " invalid";
      // and set the current valid status to false:
      valid = false;
    }
  }
  // If the valid status is true, mark the step as finished and valid:
  if (valid) {
    document.getElementsByClassName("step")[currentTab].className += " finish";
  }
  return valid; // return the valid status
}

function fixStepIndicator(n) {
  // This function removes the "active" class of all steps...
  var i, x = document.getElementsByClassName("step");
  for (i = 0; i < x.length; i++) {
    x[i].className = x[i].className.replace(" active", "");
  }
  //... and adds the "active" class to the current step:
  x[n].className += " active";
}
			</script>

	</body>
</html>
